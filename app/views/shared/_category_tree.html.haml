.Search-CategorySidelist.js-active-toggle--container
  %h2.Search-CategoryTreeHeading.js-active-toggle--trigger{ data: {maxsize: "960" }}
    %i.Icon.icon-down_arrow.js-active-toggle--target
    %i.Icon.icon-up_arrow.js-active-toggle--target
    - cat = category ? category : nil
    - cat = category.parent if category && category.children.empty? && category.parent
    - if cat
      - cat.ancestors.each do |c|
        %h3.Search-CategoryTreeParentHeading
          %a{href: category_path(c, article_search_form: search_params_merged_with( :category => category.id )), data: { remote: 'true' }}
            = c.name
  %ul.Search-CategoryTreeLevel1.js-active-toggle--target
    - if category
      - if category.children.empty? && category.parent
        %li
          = render '/shared/category_tree_leaf', category: category.parent
          %ul.Search-CategoryTreeLevel2
            - category.self_and_siblings.each do |sibling|
              - if sibling == category
                %b
                  %li= render '/shared/category_tree_leaf', category: sibling
              -else
                %li= render '/shared/category_tree_leaf', category: sibling
        - category.parent.siblings.each do |sibling|
          %li= render '/shared/category_tree_leaf', category: sibling
      - else
        %li
          %b= category.name
          %ul.Search-CategoryTreeLevel2
            - category.children.each do |child|
              %li= render '/shared/category_tree_leaf', category: child
        - category.siblings.each do |sibling|
          %li= render '/shared/category_tree_leaf', category: sibling
    - else
      - Category.other_category_last.sorted_roots.all.each do |child|
        %li= render '/shared/category_tree_leaf', category: child
